<script>
  // --- 7s ViewContent marker ---
  setTimeout(function(){
    fbq('trackCustom','ViewContent_ai5_7s');
  },7000);

  // --- Video helpers ---
  window.addEventListener('load', function () {
    const video = document.getElementById('course-video');
    const btn = document.getElementById('unmute-btn');

    setTimeout(function(){ if(btn) btn.style.display='block'; },3000);

    setTimeout(function(){
      if (video && video.paused) {
        const p = video.play();
        if (p && p.catch) p.catch(()=>{});
      }
      if (video) {
        video.addEventListener('volumechange', function () {
          if (!video.muted && btn) btn.style.display = 'none';
        });
      }
    },6000);
  });

  function unmuteVideo(){
    const v=document.getElementById('course-video');
    const b=document.getElementById('unmute-btn');
    if(!v) return;
    v.muted=false; v.play();
    if(b) b.style.display='none';
  }

  // --- Countdown (48h per user) ---
  (function(){
    const KEY='ai5_offer_deadline_v1';
    const HOURS=48; // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const ALT_LINK_AFTER_EXPIRY = "https://buy.stripe.com/bJe8wO0TG4L57C67Of6Na08"; // –ª–∏–Ω–∫ –Ω–∞ 14,90 ‚Ç¨
    const BASE_PRICE_LABEL = '–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ 14,90 ‚Ç¨';

    const now = Date.now();
    let deadline = localStorage.getItem(KEY);
    if(!deadline){
      deadline = (now + HOURS*60*60*1000).toString();
      localStorage.setItem(KEY, deadline);
    }
    deadline = parseInt(deadline,10);

    const $timer = document.getElementById('timeleft');
    const $timerWrap = document.getElementById('timer');
    const $old = document.getElementById('price-old');
    const $new = document.getElementById('price-new');
    const $badge = document.getElementById('badge');
    const $cta = document.getElementById('cta-btn');

    let expiredSent = !!sessionStorage.getItem('Offer_Expired_ai5_sent');
    let expiredHandled = false; // <-- –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ –±–ª–æ–∫–∞

    function pad(n){ return n<10?('0'+n):n; }

    function render(){
      const diff = deadline - Date.now();
      if(diff <= 0){
        if (!expiredHandled) {
          // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –æ–¥–∏–Ω —Ä–∞–∑
          if(!expiredSent){
            fbq('trackCustom','Offer_Expired_ai5');
            sessionStorage.setItem('Offer_Expired_ai5_sent','1');
            expiredSent = true;
          }
          // –≤–∏–∑—É–∞–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º –∞–∫—Ü–∏—é
          if($timerWrap){ $timerWrap.innerHTML = '‚è∞ –ê–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞'; }

          // üîÑ –ò–Ω–≤–µ—Ä—Å–∏—è —Ü–µ–Ω
          if($old){ $old.style.display='inline'; $old.textContent = '8,90 ‚Ç¨'; }
          if($new){ $new.textContent = '14,90 ‚Ç¨'; }
          if($badge){
            $badge.style.display='inline';
            $badge.textContent = '–æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞';
            $badge.style.background = '#888';
          }

          // —Å–º–µ–Ω–∞ —Å—Å—ã–ª–∫–∏ –∏ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏
          if($cta){
            $cta.href = ALT_LINK_AFTER_EXPIRY || $cta.href;
            $cta.textContent = BASE_PRICE_LABEL;
          }

          // –æ–¥–∏–Ω —Ä–∞–∑ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–æ –ø—Ä–æ–º–æ–∫–æ–¥—ã
          if (!$cta.parentNode.querySelector('#promo-hint')) {
            const promo = document.createElement('p');
            promo.id = 'promo-hint';
            promo.style.marginTop = "10px";
            promo.style.color = "#444";
            promo.style.fontSize = "0.95rem";
            promo.innerHTML = "–ù–æ —É –Ω–∞—Å –µ—Å—Ç—å üéüÔ∏è <strong>–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</strong> ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Ö –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ!";
            $cta.parentNode.appendChild(promo);
          }

          expiredHandled = true;   // <-- –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ
          clearInterval(timerId);  // <-- –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–∫–∞–Ω—å–µ
        }
        return;
      }
      const s = Math.floor(diff/1000);
      const hh = pad(Math.floor(s/3600));
      const mm = pad(Math.floor((s%3600)/60));
      const ss = pad(s%60);
      if($timer) $timer.textContent = `${hh}:${mm}:${ss}`;
    }

    render();
    const timerId = setInterval(render, 1000);
  })();
</script>
